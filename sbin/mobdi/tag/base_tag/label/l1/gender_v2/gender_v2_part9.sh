#!/bin/bash
set -x -e

if [ $# -lt 1 ]; then
    echo "Please input param: day"
    exit 1
fi
source /home/dba/mobdi_center/conf/hive-env.sh

day=$1
p7=$(date -d "$day -7 days" "+%Y%m%d")
insertday=${day}_muid
#device_applist_new="dm_mobdi_mapping.device_applist_new"

#gender_app_tgi_level_5="dm_sdk_mapping.gender_app_tgi_level_5"

#gender_pre_high_tgi_app_no="dm_sdk_mapping.gender_pre_high_tgi_app_no"

gender_feature_v2_part9="${dm_mobdi_tmp}.gender_feature_v2_part9"

hive -e "
set mapreduce.job.queuename=root.yarn_data_compliance;
set mapred.max.split.size=256000000;
set mapred.min.split.size.per.node=100000000;
set mapred.min.split.size.per.rack=100000000;
set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;
set hive.merge.smallfiles.avgsize=256000000;
set hive.merge.mapfiles = true;
set hive.merge.mapredfiles = true;
set hive.merge.size.per.task = 256000000;
set hive.exec.max.dynamic.partitions.pernode=1000;
set hive.exec.max.dynamic.partitions=10000;
insert overwrite table $gender_feature_v2_part9 partition(day='$insertday')
select t3.device, 
max(app1) app1,
max(app2) app2,
max(app3) app3,
max(app4) app4,
max(app5) app5,
max(app6) app6,
max(app7) app7,
max(app8) app8,
max(app9) app9,
max(app10) app10,
max(app11) app11,
max(app12) app12,
max(app13) app13,
max(app14) app14,
max(app15) app15,
max(app16) app16,
max(app17) app17,
max(app18) app18,
max(app19) app19,
max(app20) app20,
max(app21) app21,
max(app22) app22,
max(app23) app23,
max(app24) app24,
max(app25) app25,
max(app26) app26,
max(app27) app27,
max(app28) app28,
max(app29) app29,
max(app30) app30,
max(app31) app31,
max(app32) app32,
max(app33) app33,
max(app34) app34,
max(app35) app35,
max(app36) app36,
max(app37) app37,
max(app38) app38,
max(app39) app39,
max(app40) app40,
max(app41) app41,
max(app42) app42,
max(app43) app43,
max(app44) app44,
max(app45) app45,
max(app46) app46,
max(app47) app47,
max(app48) app48,
max(app49) app49,
max(app50) app50,
max(app51) app51,
max(app52) app52,
max(app53) app53,
max(app54) app54,
max(app55) app55,
max(app56) app56,
max(app57) app57,
max(app58) app58,
max(app59) app59,
max(app60) app60,
max(app61) app61,
max(app62) app62,
max(app63) app63,
max(app64) app64,
max(app65) app65,
max(app66) app66,
max(app67) app67,
max(app68) app68,
max(app69) app69,
max(app70) app70,
max(app71) app71,
max(app72) app72,
max(app73) app73,
max(app74) app74,
max(app75) app75,
max(app76) app76,
max(app77) app77,
max(app78) app78,
max(app79) app79,
max(app80) app80,
max(app81) app81,
max(app82) app82,
max(app83) app83,
max(app84) app84,
max(app85) app85,
max(app86) app86,
max(app87) app87,
max(app88) app88,
max(app89) app89,
max(app90) app90,
max(app91) app91,
max(app92) app92,
max(app93) app93,
max(app94) app94,
max(app95) app95,
max(app96) app96,
max(app97) app97,
max(app98) app98,
max(app99) app99,
max(app100) app100,
max(app101) app101,
max(app102) app102,
max(app103) app103,
max(app104) app104,
max(app105) app105,
max(app106) app106,
max(app107) app107,
max(app108) app108,
max(app109) app109,
max(app110) app110,
max(app111) app111,
max(app112) app112,
max(app113) app113,
max(app114) app114,
max(app115) app115,
max(app116) app116,
max(app117) app117,
max(app118) app118,
max(app119) app119,
max(app120) app120,
max(app121) app121,
max(app122) app122,
max(app123) app123,
max(app124) app124,
max(app125) app125,
max(app126) app126,
max(app127) app127,
max(app128) app128,
max(app129) app129,
max(app130) app130,
max(app131) app131,
max(app132) app132,
max(app133) app133,
max(app134) app134,
max(app135) app135,
max(app136) app136,
max(app137) app137,
max(app138) app138,
max(app139) app139,
max(app140) app140,
max(app141) app141,
max(app142) app142,
max(app143) app143,
max(app144) app144,
max(app145) app145,
max(app146) app146,
max(app147) app147,
max(app148) app148,
max(app149) app149,
max(app150) app150,
max(app151) app151,
max(app152) app152,
max(app153) app153,
max(app154) app154,
max(app155) app155,
max(app156) app156,
max(app157) app157,
max(app158) app158,
max(app159) app159,
max(app160) app160,
max(app161) app161,
max(app162) app162,
max(app163) app163,
max(app164) app164,
max(app165) app165,
max(app166) app166,
max(app167) app167,
max(app168) app168,
max(app169) app169,
max(app170) app170,
max(app171) app171,
max(app172) app172,
max(app173) app173,
max(app174) app174,
max(app175) app175,
max(app176) app176,
max(app177) app177,
max(app178) app178,
max(app179) app179,
max(app180) app180,
max(app181) app181,
max(app182) app182,
max(app183) app183,
max(app184) app184,
max(app185) app185,
max(app186) app186,
max(app187) app187,
max(app188) app188,
max(app189) app189,
max(app190) app190,
max(app191) app191,
max(app192) app192,
max(app193) app193,
max(app194) app194,
max(app195) app195,
max(app196) app196,
max(app197) app197,
max(app198) app198,
max(app199) app199,
max(app200) app200,
max(app201) app201,
max(app202) app202,
max(app203) app203,
max(app204) app204,
max(app205) app205,
max(app206) app206,
max(app207) app207,
max(app208) app208,
max(app209) app209,
max(app210) app210,
max(app211) app211,
max(app212) app212,
max(app213) app213,
max(app214) app214,
max(app215) app215,
max(app216) app216,
max(app217) app217,
max(app218) app218,
max(app219) app219,
max(app220) app220,
max(app221) app221,
max(app222) app222,
max(app223) app223,
max(app224) app224,
max(app225) app225,
max(app226) app226,
max(app227) app227,
max(app228) app228,
max(app229) app229,
max(app230) app230,
max(app231) app231,
max(app232) app232,
max(app233) app233,
max(app234) app234,
max(app235) app235,
max(app236) app236,
max(app237) app237,
max(app238) app238,
max(app239) app239,
max(app240) app240,
max(app241) app241,
max(app242) app242,
max(app243) app243,
max(app244) app244,
max(app245) app245,
max(app246) app246,
max(app247) app247,
max(app248) app248,
max(app249) app249,
max(app250) app250,
max(app251) app251,
max(app252) app252,
max(app253) app253,
max(app254) app254,
max(app255) app255,
max(app256) app256,
max(app257) app257,
max(app258) app258,
max(app259) app259,
max(app260) app260,
max(app261) app261,
max(app262) app262,
max(app263) app263,
max(app264) app264,
max(app265) app265,
max(app266) app266,
max(app267) app267,
max(app268) app268,
max(app269) app269,
max(app270) app270,
max(app271) app271,
max(app272) app272,
max(app273) app273,
max(app274) app274,
max(app275) app275,
max(app276) app276,
max(app277) app277,
max(app278) app278,
max(app279) app279,
max(app280) app280,
max(app281) app281,
max(app282) app282,
max(app283) app283,
max(app284) app284,
max(app285) app285,
max(app286) app286,
max(app287) app287,
max(app288) app288,
max(app289) app289,
max(app290) app290,
max(app291) app291,
max(app292) app292,
max(app293) app293,
max(app294) app294,
max(app295) app295,
max(app296) app296,
max(app297) app297,
max(app298) app298,
max(app299) app299,
max(app300) app300,
max(app301) app301,
max(app302) app302,
max(app303) app303,
max(app304) app304,
max(app305) app305,
max(app306) app306,
max(app307) app307,
max(app308) app308,
max(app309) app309,
max(app310) app310,
max(app311) app311,
max(app312) app312,
max(app313) app313,
max(app314) app314,
max(app315) app315,
max(app316) app316,
max(app317) app317,
max(app318) app318,
max(app319) app319,
max(app320) app320,
max(app321) app321,
max(app322) app322,
max(app323) app323,
max(app324) app324,
max(app325) app325,
max(app326) app326,
max(app327) app327,
max(app328) app328,
max(app329) app329,
max(app330) app330,
max(app331) app331,
max(app332) app332,
max(app333) app333,
max(app334) app334,
max(app335) app335,
max(app336) app336,
max(app337) app337,
max(app338) app338,
max(app339) app339,
max(app340) app340,
max(app341) app341,
max(app342) app342,
max(app343) app343,
max(app344) app344,
max(app345) app345,
max(app346) app346,
max(app347) app347,
max(app348) app348,
max(app349) app349,
max(app350) app350,
max(app351) app351,
max(app352) app352,
max(app353) app353,
max(app354) app354,
max(app355) app355,
max(app356) app356,
max(app357) app357,
max(app358) app358,
max(app359) app359,
max(app360) app360,
max(app361) app361,
max(app362) app362,
max(app363) app363,
max(app364) app364,
max(app365) app365,
max(app366) app366,
max(app367) app367,
max(app368) app368,
max(app369) app369,
max(app370) app370,
max(app371) app371,
max(app372) app372,
max(app373) app373,
max(app374) app374,
max(app375) app375,
max(app376) app376,
max(app377) app377,
max(app378) app378,
max(app379) app379,
max(app380) app380,
max(app381) app381,
max(app382) app382,
max(app383) app383,
max(app384) app384,
max(app385) app385,
max(app386) app386,
max(app387) app387,
max(app388) app388,
max(app389) app389,
max(app390) app390,
max(app391) app391,
max(app392) app392,
max(app393) app393,
max(app394) app394,
max(app395) app395,
max(app396) app396,
max(app397) app397,
max(app398) app398,
max(app399) app399,
max(app400) app400,
max(app401) app401,
max(app402) app402,
max(app403) app403,
max(app404) app404,
max(app405) app405,
max(app406) app406,
max(app407) app407,
max(app408) app408,
max(app409) app409,
max(app410) app410,
max(app411) app411,
max(app412) app412,
max(app413) app413
from (
select t1.*, 
case when t2.rk= 1 then 1 else 0 end app1,
case when t2.rk= 2 then 1 else 0 end app2,
case when t2.rk= 3 then 1 else 0 end app3,
case when t2.rk= 4 then 1 else 0 end app4,
case when t2.rk= 5 then 1 else 0 end app5,
case when t2.rk= 6 then 1 else 0 end app6,
case when t2.rk= 7 then 1 else 0 end app7,
case when t2.rk= 8 then 1 else 0 end app8,
case when t2.rk= 9 then 1 else 0 end app9,
case when t2.rk= 10 then 1 else 0 end app10,
case when t2.rk= 11 then 1 else 0 end app11,
case when t2.rk= 12 then 1 else 0 end app12,
case when t2.rk= 13 then 1 else 0 end app13,
case when t2.rk= 14 then 1 else 0 end app14,
case when t2.rk= 15 then 1 else 0 end app15,
case when t2.rk= 16 then 1 else 0 end app16,
case when t2.rk= 17 then 1 else 0 end app17,
case when t2.rk= 18 then 1 else 0 end app18,
case when t2.rk= 19 then 1 else 0 end app19,
case when t2.rk= 20 then 1 else 0 end app20,
case when t2.rk= 21 then 1 else 0 end app21,
case when t2.rk= 22 then 1 else 0 end app22,
case when t2.rk= 23 then 1 else 0 end app23,
case when t2.rk= 24 then 1 else 0 end app24,
case when t2.rk= 25 then 1 else 0 end app25,
case when t2.rk= 26 then 1 else 0 end app26,
case when t2.rk= 27 then 1 else 0 end app27,
case when t2.rk= 28 then 1 else 0 end app28,
case when t2.rk= 29 then 1 else 0 end app29,
case when t2.rk= 30 then 1 else 0 end app30,
case when t2.rk= 31 then 1 else 0 end app31,
case when t2.rk= 32 then 1 else 0 end app32,
case when t2.rk= 33 then 1 else 0 end app33,
case when t2.rk= 34 then 1 else 0 end app34,
case when t2.rk= 35 then 1 else 0 end app35,
case when t2.rk= 36 then 1 else 0 end app36,
case when t2.rk= 37 then 1 else 0 end app37,
case when t2.rk= 38 then 1 else 0 end app38,
case when t2.rk= 39 then 1 else 0 end app39,
case when t2.rk= 40 then 1 else 0 end app40,
case when t2.rk= 41 then 1 else 0 end app41,
case when t2.rk= 42 then 1 else 0 end app42,
case when t2.rk= 43 then 1 else 0 end app43,
case when t2.rk= 44 then 1 else 0 end app44,
case when t2.rk= 45 then 1 else 0 end app45,
case when t2.rk= 46 then 1 else 0 end app46,
case when t2.rk= 47 then 1 else 0 end app47,
case when t2.rk= 48 then 1 else 0 end app48,
case when t2.rk= 49 then 1 else 0 end app49,
case when t2.rk= 50 then 1 else 0 end app50,
case when t2.rk= 51 then 1 else 0 end app51,
case when t2.rk= 52 then 1 else 0 end app52,
case when t2.rk= 53 then 1 else 0 end app53,
case when t2.rk= 54 then 1 else 0 end app54,
case when t2.rk= 55 then 1 else 0 end app55,
case when t2.rk= 56 then 1 else 0 end app56,
case when t2.rk= 57 then 1 else 0 end app57,
case when t2.rk= 58 then 1 else 0 end app58,
case when t2.rk= 59 then 1 else 0 end app59,
case when t2.rk= 60 then 1 else 0 end app60,
case when t2.rk= 61 then 1 else 0 end app61,
case when t2.rk= 62 then 1 else 0 end app62,
case when t2.rk= 63 then 1 else 0 end app63,
case when t2.rk= 64 then 1 else 0 end app64,
case when t2.rk= 65 then 1 else 0 end app65,
case when t2.rk= 66 then 1 else 0 end app66,
case when t2.rk= 67 then 1 else 0 end app67,
case when t2.rk= 68 then 1 else 0 end app68,
case when t2.rk= 69 then 1 else 0 end app69,
case when t2.rk= 70 then 1 else 0 end app70,
case when t2.rk= 71 then 1 else 0 end app71,
case when t2.rk= 72 then 1 else 0 end app72,
case when t2.rk= 73 then 1 else 0 end app73,
case when t2.rk= 74 then 1 else 0 end app74,
case when t2.rk= 75 then 1 else 0 end app75,
case when t2.rk= 76 then 1 else 0 end app76,
case when t2.rk= 77 then 1 else 0 end app77,
case when t2.rk= 78 then 1 else 0 end app78,
case when t2.rk= 79 then 1 else 0 end app79,
case when t2.rk= 80 then 1 else 0 end app80,
case when t2.rk= 81 then 1 else 0 end app81,
case when t2.rk= 82 then 1 else 0 end app82,
case when t2.rk= 83 then 1 else 0 end app83,
case when t2.rk= 84 then 1 else 0 end app84,
case when t2.rk= 85 then 1 else 0 end app85,
case when t2.rk= 86 then 1 else 0 end app86,
case when t2.rk= 87 then 1 else 0 end app87,
case when t2.rk= 88 then 1 else 0 end app88,
case when t2.rk= 89 then 1 else 0 end app89,
case when t2.rk= 90 then 1 else 0 end app90,
case when t2.rk= 91 then 1 else 0 end app91,
case when t2.rk= 92 then 1 else 0 end app92,
case when t2.rk= 93 then 1 else 0 end app93,
case when t2.rk= 94 then 1 else 0 end app94,
case when t2.rk= 95 then 1 else 0 end app95,
case when t2.rk= 96 then 1 else 0 end app96,
case when t2.rk= 97 then 1 else 0 end app97,
case when t2.rk= 98 then 1 else 0 end app98,
case when t2.rk= 99 then 1 else 0 end app99,
case when t2.rk= 100 then 1 else 0 end app100,
case when t2.rk= 101 then 1 else 0 end app101,
case when t2.rk= 102 then 1 else 0 end app102,
case when t2.rk= 103 then 1 else 0 end app103,
case when t2.rk= 104 then 1 else 0 end app104,
case when t2.rk= 105 then 1 else 0 end app105,
case when t2.rk= 106 then 1 else 0 end app106,
case when t2.rk= 107 then 1 else 0 end app107,
case when t2.rk= 108 then 1 else 0 end app108,
case when t2.rk= 109 then 1 else 0 end app109,
case when t2.rk= 110 then 1 else 0 end app110,
case when t2.rk= 111 then 1 else 0 end app111,
case when t2.rk= 112 then 1 else 0 end app112,
case when t2.rk= 113 then 1 else 0 end app113,
case when t2.rk= 114 then 1 else 0 end app114,
case when t2.rk= 115 then 1 else 0 end app115,
case when t2.rk= 116 then 1 else 0 end app116,
case when t2.rk= 117 then 1 else 0 end app117,
case when t2.rk= 118 then 1 else 0 end app118,
case when t2.rk= 119 then 1 else 0 end app119,
case when t2.rk= 120 then 1 else 0 end app120,
case when t2.rk= 121 then 1 else 0 end app121,
case when t2.rk= 122 then 1 else 0 end app122,
case when t2.rk= 123 then 1 else 0 end app123,
case when t2.rk= 124 then 1 else 0 end app124,
case when t2.rk= 125 then 1 else 0 end app125,
case when t2.rk= 126 then 1 else 0 end app126,
case when t2.rk= 127 then 1 else 0 end app127,
case when t2.rk= 128 then 1 else 0 end app128,
case when t2.rk= 129 then 1 else 0 end app129,
case when t2.rk= 130 then 1 else 0 end app130,
case when t2.rk= 131 then 1 else 0 end app131,
case when t2.rk= 132 then 1 else 0 end app132,
case when t2.rk= 133 then 1 else 0 end app133,
case when t2.rk= 134 then 1 else 0 end app134,
case when t2.rk= 135 then 1 else 0 end app135,
case when t2.rk= 136 then 1 else 0 end app136,
case when t2.rk= 137 then 1 else 0 end app137,
case when t2.rk= 138 then 1 else 0 end app138,
case when t2.rk= 139 then 1 else 0 end app139,
case when t2.rk= 140 then 1 else 0 end app140,
case when t2.rk= 141 then 1 else 0 end app141,
case when t2.rk= 142 then 1 else 0 end app142,
case when t2.rk= 143 then 1 else 0 end app143,
case when t2.rk= 144 then 1 else 0 end app144,
case when t2.rk= 145 then 1 else 0 end app145,
case when t2.rk= 146 then 1 else 0 end app146,
case when t2.rk= 147 then 1 else 0 end app147,
case when t2.rk= 148 then 1 else 0 end app148,
case when t2.rk= 149 then 1 else 0 end app149,
case when t2.rk= 150 then 1 else 0 end app150,
case when t2.rk= 151 then 1 else 0 end app151,
case when t2.rk= 152 then 1 else 0 end app152,
case when t2.rk= 153 then 1 else 0 end app153,
case when t2.rk= 154 then 1 else 0 end app154,
case when t2.rk= 155 then 1 else 0 end app155,
case when t2.rk= 156 then 1 else 0 end app156,
case when t2.rk= 157 then 1 else 0 end app157,
case when t2.rk= 158 then 1 else 0 end app158,
case when t2.rk= 159 then 1 else 0 end app159,
case when t2.rk= 160 then 1 else 0 end app160,
case when t2.rk= 161 then 1 else 0 end app161,
case when t2.rk= 162 then 1 else 0 end app162,
case when t2.rk= 163 then 1 else 0 end app163,
case when t2.rk= 164 then 1 else 0 end app164,
case when t2.rk= 165 then 1 else 0 end app165,
case when t2.rk= 166 then 1 else 0 end app166,
case when t2.rk= 167 then 1 else 0 end app167,
case when t2.rk= 168 then 1 else 0 end app168,
case when t2.rk= 169 then 1 else 0 end app169,
case when t2.rk= 170 then 1 else 0 end app170,
case when t2.rk= 171 then 1 else 0 end app171,
case when t2.rk= 172 then 1 else 0 end app172,
case when t2.rk= 173 then 1 else 0 end app173,
case when t2.rk= 174 then 1 else 0 end app174,
case when t2.rk= 175 then 1 else 0 end app175,
case when t2.rk= 176 then 1 else 0 end app176,
case when t2.rk= 177 then 1 else 0 end app177,
case when t2.rk= 178 then 1 else 0 end app178,
case when t2.rk= 179 then 1 else 0 end app179,
case when t2.rk= 180 then 1 else 0 end app180,
case when t2.rk= 181 then 1 else 0 end app181,
case when t2.rk= 182 then 1 else 0 end app182,
case when t2.rk= 183 then 1 else 0 end app183,
case when t2.rk= 184 then 1 else 0 end app184,
case when t2.rk= 185 then 1 else 0 end app185,
case when t2.rk= 186 then 1 else 0 end app186,
case when t2.rk= 187 then 1 else 0 end app187,
case when t2.rk= 188 then 1 else 0 end app188,
case when t2.rk= 189 then 1 else 0 end app189,
case when t2.rk= 190 then 1 else 0 end app190,
case when t2.rk= 191 then 1 else 0 end app191,
case when t2.rk= 192 then 1 else 0 end app192,
case when t2.rk= 193 then 1 else 0 end app193,
case when t2.rk= 194 then 1 else 0 end app194,
case when t2.rk= 195 then 1 else 0 end app195,
case when t2.rk= 196 then 1 else 0 end app196,
case when t2.rk= 197 then 1 else 0 end app197,
case when t2.rk= 198 then 1 else 0 end app198,
case when t2.rk= 199 then 1 else 0 end app199,
case when t2.rk= 200 then 1 else 0 end app200,
case when t2.rk= 201 then 1 else 0 end app201,
case when t2.rk= 202 then 1 else 0 end app202,
case when t2.rk= 203 then 1 else 0 end app203,
case when t2.rk= 204 then 1 else 0 end app204,
case when t2.rk= 205 then 1 else 0 end app205,
case when t2.rk= 206 then 1 else 0 end app206,
case when t2.rk= 207 then 1 else 0 end app207,
case when t2.rk= 208 then 1 else 0 end app208,
case when t2.rk= 209 then 1 else 0 end app209,
case when t2.rk= 210 then 1 else 0 end app210,
case when t2.rk= 211 then 1 else 0 end app211,
case when t2.rk= 212 then 1 else 0 end app212,
case when t2.rk= 213 then 1 else 0 end app213,
case when t2.rk= 214 then 1 else 0 end app214,
case when t2.rk= 215 then 1 else 0 end app215,
case when t2.rk= 216 then 1 else 0 end app216,
case when t2.rk= 217 then 1 else 0 end app217,
case when t2.rk= 218 then 1 else 0 end app218,
case when t2.rk= 219 then 1 else 0 end app219,
case when t2.rk= 220 then 1 else 0 end app220,
case when t2.rk= 221 then 1 else 0 end app221,
case when t2.rk= 222 then 1 else 0 end app222,
case when t2.rk= 223 then 1 else 0 end app223,
case when t2.rk= 224 then 1 else 0 end app224,
case when t2.rk= 225 then 1 else 0 end app225,
case when t2.rk= 226 then 1 else 0 end app226,
case when t2.rk= 227 then 1 else 0 end app227,
case when t2.rk= 228 then 1 else 0 end app228,
case when t2.rk= 229 then 1 else 0 end app229,
case when t2.rk= 230 then 1 else 0 end app230,
case when t2.rk= 231 then 1 else 0 end app231,
case when t2.rk= 232 then 1 else 0 end app232,
case when t2.rk= 233 then 1 else 0 end app233,
case when t2.rk= 234 then 1 else 0 end app234,
case when t2.rk= 235 then 1 else 0 end app235,
case when t2.rk= 236 then 1 else 0 end app236,
case when t2.rk= 237 then 1 else 0 end app237,
case when t2.rk= 238 then 1 else 0 end app238,
case when t2.rk= 239 then 1 else 0 end app239,
case when t2.rk= 240 then 1 else 0 end app240,
case when t2.rk= 241 then 1 else 0 end app241,
case when t2.rk= 242 then 1 else 0 end app242,
case when t2.rk= 243 then 1 else 0 end app243,
case when t2.rk= 244 then 1 else 0 end app244,
case when t2.rk= 245 then 1 else 0 end app245,
case when t2.rk= 246 then 1 else 0 end app246,
case when t2.rk= 247 then 1 else 0 end app247,
case when t2.rk= 248 then 1 else 0 end app248,
case when t2.rk= 249 then 1 else 0 end app249,
case when t2.rk= 250 then 1 else 0 end app250,
case when t2.rk= 251 then 1 else 0 end app251,
case when t2.rk= 252 then 1 else 0 end app252,
case when t2.rk= 253 then 1 else 0 end app253,
case when t2.rk= 254 then 1 else 0 end app254,
case when t2.rk= 255 then 1 else 0 end app255,
case when t2.rk= 256 then 1 else 0 end app256,
case when t2.rk= 257 then 1 else 0 end app257,
case when t2.rk= 258 then 1 else 0 end app258,
case when t2.rk= 259 then 1 else 0 end app259,
case when t2.rk= 260 then 1 else 0 end app260,
case when t2.rk= 261 then 1 else 0 end app261,
case when t2.rk= 262 then 1 else 0 end app262,
case when t2.rk= 263 then 1 else 0 end app263,
case when t2.rk= 264 then 1 else 0 end app264,
case when t2.rk= 265 then 1 else 0 end app265,
case when t2.rk= 266 then 1 else 0 end app266,
case when t2.rk= 267 then 1 else 0 end app267,
case when t2.rk= 268 then 1 else 0 end app268,
case when t2.rk= 269 then 1 else 0 end app269,
case when t2.rk= 270 then 1 else 0 end app270,
case when t2.rk= 271 then 1 else 0 end app271,
case when t2.rk= 272 then 1 else 0 end app272,
case when t2.rk= 273 then 1 else 0 end app273,
case when t2.rk= 274 then 1 else 0 end app274,
case when t2.rk= 275 then 1 else 0 end app275,
case when t2.rk= 276 then 1 else 0 end app276,
case when t2.rk= 277 then 1 else 0 end app277,
case when t2.rk= 278 then 1 else 0 end app278,
case when t2.rk= 279 then 1 else 0 end app279,
case when t2.rk= 280 then 1 else 0 end app280,
case when t2.rk= 281 then 1 else 0 end app281,
case when t2.rk= 282 then 1 else 0 end app282,
case when t2.rk= 283 then 1 else 0 end app283,
case when t2.rk= 284 then 1 else 0 end app284,
case when t2.rk= 285 then 1 else 0 end app285,
case when t2.rk= 286 then 1 else 0 end app286,
case when t2.rk= 287 then 1 else 0 end app287,
case when t2.rk= 288 then 1 else 0 end app288,
case when t2.rk= 289 then 1 else 0 end app289,
case when t2.rk= 290 then 1 else 0 end app290,
case when t2.rk= 291 then 1 else 0 end app291,
case when t2.rk= 292 then 1 else 0 end app292,
case when t2.rk= 293 then 1 else 0 end app293,
case when t2.rk= 294 then 1 else 0 end app294,
case when t2.rk= 295 then 1 else 0 end app295,
case when t2.rk= 296 then 1 else 0 end app296,
case when t2.rk= 297 then 1 else 0 end app297,
case when t2.rk= 298 then 1 else 0 end app298,
case when t2.rk= 299 then 1 else 0 end app299,
case when t2.rk= 300 then 1 else 0 end app300,
case when t2.rk= 301 then 1 else 0 end app301,
case when t2.rk= 302 then 1 else 0 end app302,
case when t2.rk= 303 then 1 else 0 end app303,
case when t2.rk= 304 then 1 else 0 end app304,
case when t2.rk= 305 then 1 else 0 end app305,
case when t2.rk= 306 then 1 else 0 end app306,
case when t2.rk= 307 then 1 else 0 end app307,
case when t2.rk= 308 then 1 else 0 end app308,
case when t2.rk= 309 then 1 else 0 end app309,
case when t2.rk= 310 then 1 else 0 end app310,
case when t2.rk= 311 then 1 else 0 end app311,
case when t2.rk= 312 then 1 else 0 end app312,
case when t2.rk= 313 then 1 else 0 end app313,
case when t2.rk= 314 then 1 else 0 end app314,
case when t2.rk= 315 then 1 else 0 end app315,
case when t2.rk= 316 then 1 else 0 end app316,
case when t2.rk= 317 then 1 else 0 end app317,
case when t2.rk= 318 then 1 else 0 end app318,
case when t2.rk= 319 then 1 else 0 end app319,
case when t2.rk= 320 then 1 else 0 end app320,
case when t2.rk= 321 then 1 else 0 end app321,
case when t2.rk= 322 then 1 else 0 end app322,
case when t2.rk= 323 then 1 else 0 end app323,
case when t2.rk= 324 then 1 else 0 end app324,
case when t2.rk= 325 then 1 else 0 end app325,
case when t2.rk= 326 then 1 else 0 end app326,
case when t2.rk= 327 then 1 else 0 end app327,
case when t2.rk= 328 then 1 else 0 end app328,
case when t2.rk= 329 then 1 else 0 end app329,
case when t2.rk= 330 then 1 else 0 end app330,
case when t2.rk= 331 then 1 else 0 end app331,
case when t2.rk= 332 then 1 else 0 end app332,
case when t2.rk= 333 then 1 else 0 end app333,
case when t2.rk= 334 then 1 else 0 end app334,
case when t2.rk= 335 then 1 else 0 end app335,
case when t2.rk= 336 then 1 else 0 end app336,
case when t2.rk= 337 then 1 else 0 end app337,
case when t2.rk= 338 then 1 else 0 end app338,
case when t2.rk= 339 then 1 else 0 end app339,
case when t2.rk= 340 then 1 else 0 end app340,
case when t2.rk= 341 then 1 else 0 end app341,
case when t2.rk= 342 then 1 else 0 end app342,
case when t2.rk= 343 then 1 else 0 end app343,
case when t2.rk= 344 then 1 else 0 end app344,
case when t2.rk= 345 then 1 else 0 end app345,
case when t2.rk= 346 then 1 else 0 end app346,
case when t2.rk= 347 then 1 else 0 end app347,
case when t2.rk= 348 then 1 else 0 end app348,
case when t2.rk= 349 then 1 else 0 end app349,
case when t2.rk= 350 then 1 else 0 end app350,
case when t2.rk= 351 then 1 else 0 end app351,
case when t2.rk= 352 then 1 else 0 end app352,
case when t2.rk= 353 then 1 else 0 end app353,
case when t2.rk= 354 then 1 else 0 end app354,
case when t2.rk= 355 then 1 else 0 end app355,
case when t2.rk= 356 then 1 else 0 end app356,
case when t2.rk= 357 then 1 else 0 end app357,
case when t2.rk= 358 then 1 else 0 end app358,
case when t2.rk= 359 then 1 else 0 end app359,
case when t2.rk= 360 then 1 else 0 end app360,
case when t2.rk= 361 then 1 else 0 end app361,
case when t2.rk= 362 then 1 else 0 end app362,
case when t2.rk= 363 then 1 else 0 end app363,
case when t2.rk= 364 then 1 else 0 end app364,
case when t2.rk= 365 then 1 else 0 end app365,
case when t2.rk= 366 then 1 else 0 end app366,
case when t2.rk= 367 then 1 else 0 end app367,
case when t2.rk= 368 then 1 else 0 end app368,
case when t2.rk= 369 then 1 else 0 end app369,
case when t2.rk= 370 then 1 else 0 end app370,
case when t2.rk= 371 then 1 else 0 end app371,
case when t2.rk= 372 then 1 else 0 end app372,
case when t2.rk= 373 then 1 else 0 end app373,
case when t2.rk= 374 then 1 else 0 end app374,
case when t2.rk= 375 then 1 else 0 end app375,
case when t2.rk= 376 then 1 else 0 end app376,
case when t2.rk= 377 then 1 else 0 end app377,
case when t2.rk= 378 then 1 else 0 end app378,
case when t2.rk= 379 then 1 else 0 end app379,
case when t2.rk= 380 then 1 else 0 end app380,
case when t2.rk= 381 then 1 else 0 end app381,
case when t2.rk= 382 then 1 else 0 end app382,
case when t2.rk= 383 then 1 else 0 end app383,
case when t2.rk= 384 then 1 else 0 end app384,
case when t2.rk= 385 then 1 else 0 end app385,
case when t2.rk= 386 then 1 else 0 end app386,
case when t2.rk= 387 then 1 else 0 end app387,
case when t2.rk= 388 then 1 else 0 end app388,
case when t2.rk= 389 then 1 else 0 end app389,
case when t2.rk= 390 then 1 else 0 end app390,
case when t2.rk= 391 then 1 else 0 end app391,
case when t2.rk= 392 then 1 else 0 end app392,
case when t2.rk= 393 then 1 else 0 end app393,
case when t2.rk= 394 then 1 else 0 end app394,
case when t2.rk= 395 then 1 else 0 end app395,
case when t2.rk= 396 then 1 else 0 end app396,
case when t2.rk= 397 then 1 else 0 end app397,
case when t2.rk= 398 then 1 else 0 end app398,
case when t2.rk= 399 then 1 else 0 end app399,
case when t2.rk= 400 then 1 else 0 end app400,
case when t2.rk= 401 then 1 else 0 end app401,
case when t2.rk= 402 then 1 else 0 end app402,
case when t2.rk= 403 then 1 else 0 end app403,
case when t2.rk= 404 then 1 else 0 end app404,
case when t2.rk= 405 then 1 else 0 end app405,
case when t2.rk= 406 then 1 else 0 end app406,
case when t2.rk= 407 then 1 else 0 end app407,
case when t2.rk= 408 then 1 else 0 end app408,
case when t2.rk= 409 then 1 else 0 end app409,
case when t2.rk= 410 then 1 else 0 end app410,
case when t2.rk= 411 then 1 else 0 end app411,
case when t2.rk= 412 then 1 else 0 end app412,
case when t2.rk= 413 then 1 else 0 end app413
from (
select a.device, a.apppkg, b.tgi
from (select device,pkg apppkg from $dim_device_applist_new_di where day = '$day') a
join (
select * from $dim_gender_app_tgi_level_5 where tag=1 and sample_cnt>10000 and (tgi<0.9 or tgi>=1.1)
) b
on a.apppkg=b.apppkg
group by a.device, a.apppkg, b.tgi
) t1 
join $dim_gender_pre_high_tgi_app_no t2
on t1.apppkg=t2.apppkg
) t3
group by t3.device;
"