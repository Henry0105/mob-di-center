#!/bin/bash
set -x -e

if [ $# -lt 1 ]; then
    echo "Please input param: day"
    exit 1
fi
source /home/dba/mobdi_center/conf/hive-env.sh

day=$1
p7=$(date -d "$day -7 days" "+%Y%m%d")
insertday=${day}_muid
#device_applist_new="dm_mobdi_mapping.device_applist_new"

gender_feature_v2_part17="${dm_mobdi_tmp}.gender_feature_v2_part17"

#app_category_mapping_par="dm_sdk_mapping.app_category_mapping_par"

#gender_app2vec_cate_l2_center="dm_sdk_mapping.gender_app2vec_cate_l2_center"

#gender_app2vec_cate_l2_center_vec_m="dm_sdk_mapping.gender_app2vec_cate_l2_center_vec_m"

#gender_app_cate_index2="dm_sdk_mapping.gender_app_cate_index2"

#apppkg_app2vec_par_wi="rp_mobdi_app.apppkg_app2vec_par_wi"

last_par=20210418

sql="
select device, cate_l2_id, cate_l2,
avg(d1) as d1,avg(d2) as d2,avg(d3) as d3,avg(d4) as d4,avg(d5) as d5,avg(d6) as d6,avg(d7) as d7,avg(d8) as d8,avg(d9) as d9,
avg(d10) as d10,avg(d11) as d11,avg(d12) as d12,avg(d13) as d13,avg(d14) as d14,avg(d15) as d15,avg(d16) as d16,avg(d17) as d17,
avg(d18) as d18,avg(d19) as d19,avg(d20) as d20,avg(d21) as d21,avg(d22) as d22,avg(d23) as d23,avg(d24) as d24,avg(d25) as d25,
avg(d26) as d26,avg(d27) as d27,avg(d28) as d28,avg(d29) as d29,avg(d30) as d30,avg(d31) as d31,avg(d32) as d32,avg(d33) as d33,
avg(d34) as d34,avg(d35) as d35,avg(d36) as d36,avg(d37) as d37,avg(d38) as d38,avg(d39) as d39,avg(d40) as d40,avg(d41) as d41,
avg(d42) as d42,avg(d43) as d43,avg(d44) as d44,avg(d45) as d45,avg(d46) as d46,avg(d47) as d47,avg(d48) as d48,avg(d49) as d49,
avg(d50) as d50,avg(d51) as d51,avg(d52) as d52,avg(d53) as d53,avg(d54) as d54,avg(d55) as d55,avg(d56) as d56,avg(d57) as d57,
avg(d58) as d58,avg(d59) as d59,avg(d60) as d60,avg(d61) as d61,avg(d62) as d62,avg(d63) as d63,avg(d64) as d64,avg(d65) as d65,
avg(d66) as d66,avg(d67) as d67,avg(d68) as d68,avg(d69) as d69,avg(d70) as d70,avg(d71) as d71,avg(d72) as d72,avg(d73) as d73,
avg(d74) as d74,avg(d75) as d75,avg(d76) as d76,avg(d77) as d77,avg(d78) as d78,avg(d79) as d79,avg(d80) as d80,avg(d81) as d81,
avg(d82) as d82,avg(d83) as d83,avg(d84) as d84,avg(d85) as d85,avg(d86) as d86,avg(d87) as d87,avg(d88) as d88,avg(d89) as d89,
avg(d90) as d90,avg(d91) as d91,avg(d92) as d92,avg(d93) as d93,avg(d94) as d94,avg(d95) as d95,avg(d96) as d96,avg(d97) as d97,
avg(d98) as d98,avg(d99) as d99,avg(d100) as d100
from seed x
join (select * from $apppkg_app2vec_par_wi where day = '$last_par') y on x.pkg = y.apppkg
join (select apppkg, cate_l2_id, cate_l2 from $app_category_mapping_par where version='1000' group by apppkg, cate_l2_id, cate_l2) z
on x.pkg=z.apppkg
group by device, cate_l2_id, cate_l2
"

#output
gender_device_cate_l2_app2vec_vec2_score=${dm_mobdi_tmp}.gender_device_cate_l2_app2vec_vec2_score

spark2-submit --master yarn --deploy-mode cluster \
--class com.youzu.mob.newscore.App2Vec \
--driver-memory 4G \
--queue root.yarn_data_compliance \
--executor-memory 15G \
--executor-cores 4 \
--conf spark.shuffle.service.enabled=true \
--conf spark.dynamicAllocation.enabled=true \
--conf spark.dynamicAllocation.minExecutors=100 \
--conf spark.dynamicAllocation.maxExecutors=200 \
--conf spark.dynamicAllocation.executorIdleTimeout=30s \
--conf spark.dynamicAllocation.schedulerBacklogTimeout=5s \
--conf spark.yarn.executor.memoryOverhead=4096 \
--conf spark.kryoserializer.buffer.max=1024 \
--conf spark.speculation=true \
--conf spark.driver.maxResultSize=4g \
--conf spark.default.parallelism=2000 \
--conf spark.sql.shuffle.partitions=2000 \
--conf spark.driver.extraJavaOptions="-XX:MaxPermSize=1024m -XX:PermSize=256m" \
/home/dba/mobdi_center/lib/MobDI-center-spark2-1.0-SNAPSHOT-jar-with-dependencies.jar \
--inputTable $dim_device_applist_new_di \
--outputTable $gender_device_cate_l2_app2vec_vec2_score \
--day $day \
--sql "$sql" \
--flag "gender_v2_17_app2vec"

hive -e "
set mapreduce.job.queuename=root.yarn_data_compliance;
set mapred.max.split.size=256000000;
set mapred.min.split.size.per.node=100000000;
set mapred.min.split.size.per.rack=100000000;
set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;
set hive.merge.smallfiles.avgsize=256000000;
set hive.merge.mapfiles = true;
set hive.merge.mapredfiles = true;
set hive.merge.size.per.task = 256000000;
set hive.exec.max.dynamic.partitions.pernode=1000;
set hive.exec.max.dynamic.partitions=10000;

insert overwrite table $gender_feature_v2_part17 partition(day=$insertday)
select device, 
max(index1) index1,
max(index2) index2,
max(index3) index3,
max(index4) index4,
max(index5) index5,
max(index6) index6,
max(index7) index7,
max(index8) index8,
max(index9) index9,
max(index10) index10,
max(index11) index11,
max(index12) index12,
max(index13) index13,
max(index14) index14,
max(index15) index15,
max(index16) index16,
max(index17) index17,
max(index18) index18,
max(index19) index19,
max(index20) index20,
max(index21) index21,
max(index22) index22,
max(index23) index23,
max(index24) index24,
max(index25) index25,
max(index26) index26,
max(index27) index27,
max(index28) index28,
max(index29) index29,
max(index30) index30,
max(index31) index31,
max(index32) index32,
max(index33) index33,
max(index34) index34,
max(index35) index35,
max(index36) index36,
max(index37) index37,
max(index38) index38,
max(index39) index39,
max(index40) index40,
max(index41) index41,
max(index42) index42,
max(index43) index43,
max(index44) index44,
max(index45) index45,
max(index46) index46,
max(index47) index47,
max(index48) index48,
max(index49) index49,
max(index50) index50,
max(index51) index51,
max(index52) index52,
max(index53) index53,
max(index54) index54,
max(index55) index55,
max(index56) index56,
max(index57) index57,
max(index58) index58,
max(index59) index59,
max(index60) index60,
max(index61) index61,
max(index62) index62,
max(index63) index63,
max(index64) index64,
max(index65) index65,
max(index66) index66,
max(index67) index67,
max(index68) index68,
max(index69) index69,
max(index70) index70,
max(index71) index71,
max(index72) index72,
max(index73) index73,
max(index74) index74,
max(index75) index75,
max(index76) index76,
max(index77) index77,
max(index78) index78,
max(index79) index79,
max(index80) index80,
max(index81) index81,
max(index82) index82,
max(index83) index83,
max(index84) index84,
max(index85) index85,
max(index86) index86,
max(index87) index87,
max(index88) index88,
max(index89) index89,
max(index90) index90,
max(index91) index91,
max(index92) index92,
max(index93) index93,
max(index94) index94,
max(index95) index95,
max(index96) index96,
max(index97) index97,
max(index98) index98,
max(index99) index99,
max(index100) index100,
max(index101) index101,
max(index102) index102,
max(index103) index103,
max(index104) index104,
max(index105) index105,
max(index106) index106,
max(index107) index107,
max(index108) index108,
max(index109) index109,
max(index110) index110,
max(index111) index111,
max(index112) index112,
max(index113) index113,
max(index114) index114,
max(index115) index115,
max(index116) index116,
max(index117) index117,
max(index118) index118,
max(index119) index119,
max(index120) index120,
max(index121) index121,
max(index122) index122,
max(index123) index123,
max(index124) index124,
max(index125) index125,
max(index126) index126,
max(index127) index127,
max(index128) index128,
max(index129) index129,
max(index130) index130,
max(index131) index131,
max(index132) index132,
max(index133) index133,
max(index134) index134,
max(index135) index135,
max(index136) index136,
max(index137) index137,
max(index138) index138,
max(index139) index139,
max(index140) index140,
max(index141) index141,
max(index142) index142,
max(index143) index143,
max(index144) index144,
max(index145) index145,
max(index146) index146,
max(index147) index147,
max(index148) index148,
max(index149) index149,
max(index150) index150,
max(index151) index151,
max(index152) index152,
max(index153) index153,
max(index154) index154,
max(index155) index155,
max(index156) index156,
max(index157) index157,
max(index158) index158,
max(index159) index159,
max(index160) index160,
max(index161) index161,
max(index162) index162,
max(index163) index163,
max(index164) index164,
max(index165) index165,
max(index166) index166,
max(index167) index167,
max(index168) index168,
max(index169) index169,
max(index170) index170,
max(index171) index171,
max(index172) index172,
max(index173) index173,
max(index174) index174,
max(index175) index175,
max(index176) index176,
max(index177) index177,
max(index178) index178,
max(index179) index179,
max(index180) index180,
max(index181) index181,
max(index182) index182,
max(index183) index183,
max(index184) index184,
max(index185) index185,
max(index186) index186,
max(index187) index187,
max(index188) index188,
max(index189) index189,
max(index190) index190,
max(index191) index191,
max(index192) index192,
max(index193) index193,
max(index194) index194,
max(index195) index195,
max(index196) index196,
max(index197) index197,
max(index198) index198,
max(index199) index199,
max(index200) index200,
max(index201) index201,
max(index202) index202,
max(index203) index203,
max(index204) index204,
max(index205) index205,
max(index206) index206,
max(index207) index207,
max(index208) index208,
max(index209) index209,
max(index210) index210,
max(index211) index211,
max(index212) index212,
max(index213) index213,
max(index214) index214,
max(index1_female) index1_female,
max(index2_female) index2_female,
max(index3_female) index3_female,
max(index4_female) index4_female,
max(index5_female) index5_female,
max(index6_female) index6_female,
max(index7_female) index7_female,
max(index8_female) index8_female,
max(index9_female) index9_female,
max(index10_female) index10_female,
max(index11_female) index11_female,
max(index12_female) index12_female,
max(index13_female) index13_female,
max(index14_female) index14_female,
max(index15_female) index15_female,
max(index16_female) index16_female,
max(index17_female) index17_female,
max(index18_female) index18_female,
max(index19_female) index19_female,
max(index20_female) index20_female,
max(index21_female) index21_female,
max(index22_female) index22_female,
max(index23_female) index23_female,
max(index24_female) index24_female,
max(index25_female) index25_female,
max(index26_female) index26_female,
max(index27_female) index27_female,
max(index28_female) index28_female,
max(index29_female) index29_female,
max(index30_female) index30_female,
max(index31_female) index31_female,
max(index32_female) index32_female,
max(index33_female) index33_female,
max(index34_female) index34_female,
max(index35_female) index35_female,
max(index36_female) index36_female,
max(index37_female) index37_female,
max(index38_female) index38_female,
max(index39_female) index39_female,
max(index40_female) index40_female,
max(index41_female) index41_female,
max(index42_female) index42_female,
max(index43_female) index43_female,
max(index44_female) index44_female,
max(index45_female) index45_female,
max(index46_female) index46_female,
max(index47_female) index47_female,
max(index48_female) index48_female,
max(index49_female) index49_female,
max(index50_female) index50_female,
max(index51_female) index51_female,
max(index52_female) index52_female,
max(index53_female) index53_female,
max(index54_female) index54_female,
max(index55_female) index55_female,
max(index56_female) index56_female,
max(index57_female) index57_female,
max(index58_female) index58_female,
max(index59_female) index59_female,
max(index60_female) index60_female,
max(index61_female) index61_female,
max(index62_female) index62_female,
max(index63_female) index63_female,
max(index64_female) index64_female,
max(index65_female) index65_female,
max(index66_female) index66_female,
max(index67_female) index67_female,
max(index68_female) index68_female,
max(index69_female) index69_female,
max(index70_female) index70_female,
max(index71_female) index71_female,
max(index72_female) index72_female,
max(index73_female) index73_female,
max(index74_female) index74_female,
max(index75_female) index75_female,
max(index76_female) index76_female,
max(index77_female) index77_female,
max(index78_female) index78_female,
max(index79_female) index79_female,
max(index80_female) index80_female,
max(index81_female) index81_female,
max(index82_female) index82_female,
max(index83_female) index83_female,
max(index84_female) index84_female,
max(index85_female) index85_female,
max(index86_female) index86_female,
max(index87_female) index87_female,
max(index88_female) index88_female,
max(index89_female) index89_female,
max(index90_female) index90_female,
max(index91_female) index91_female,
max(index92_female) index92_female,
max(index93_female) index93_female,
max(index94_female) index94_female,
max(index95_female) index95_female,
max(index96_female) index96_female,
max(index97_female) index97_female,
max(index98_female) index98_female,
max(index99_female) index99_female,
max(index100_female) index100_female,
max(index101_female) index101_female,
max(index102_female) index102_female,
max(index103_female) index103_female,
max(index104_female) index104_female,
max(index105_female) index105_female,
max(index106_female) index106_female,
max(index107_female) index107_female,
max(index108_female) index108_female,
max(index109_female) index109_female,
max(index110_female) index110_female,
max(index111_female) index111_female,
max(index112_female) index112_female,
max(index113_female) index113_female,
max(index114_female) index114_female,
max(index115_female) index115_female,
max(index116_female) index116_female,
max(index117_female) index117_female,
max(index118_female) index118_female,
max(index119_female) index119_female,
max(index120_female) index120_female,
max(index121_female) index121_female,
max(index122_female) index122_female,
max(index123_female) index123_female,
max(index124_female) index124_female,
max(index125_female) index125_female,
max(index126_female) index126_female,
max(index127_female) index127_female,
max(index128_female) index128_female,
max(index129_female) index129_female,
max(index130_female) index130_female,
max(index131_female) index131_female,
max(index132_female) index132_female,
max(index133_female) index133_female,
max(index134_female) index134_female,
max(index135_female) index135_female,
max(index136_female) index136_female,
max(index137_female) index137_female,
max(index138_female) index138_female,
max(index139_female) index139_female,
max(index140_female) index140_female,
max(index141_female) index141_female,
max(index142_female) index142_female,
max(index143_female) index143_female,
max(index144_female) index144_female,
max(index145_female) index145_female,
max(index146_female) index146_female,
max(index147_female) index147_female,
max(index148_female) index148_female,
max(index149_female) index149_female,
max(index150_female) index150_female,
max(index151_female) index151_female,
max(index152_female) index152_female,
max(index153_female) index153_female,
max(index154_female) index154_female,
max(index155_female) index155_female,
max(index156_female) index156_female,
max(index157_female) index157_female,
max(index158_female) index158_female,
max(index159_female) index159_female,
max(index160_female) index160_female,
max(index161_female) index161_female,
max(index162_female) index162_female,
max(index163_female) index163_female,
max(index164_female) index164_female,
max(index165_female) index165_female,
max(index166_female) index166_female,
max(index167_female) index167_female,
max(index168_female) index168_female,
max(index169_female) index169_female,
max(index170_female) index170_female,
max(index171_female) index171_female,
max(index172_female) index172_female,
max(index173_female) index173_female,
max(index174_female) index174_female,
max(index175_female) index175_female,
max(index176_female) index176_female,
max(index177_female) index177_female,
max(index178_female) index178_female,
max(index179_female) index179_female,
max(index180_female) index180_female,
max(index181_female) index181_female,
max(index182_female) index182_female,
max(index183_female) index183_female,
max(index184_female) index184_female,
max(index185_female) index185_female,
max(index186_female) index186_female,
max(index187_female) index187_female,
max(index188_female) index188_female,
max(index189_female) index189_female,
max(index190_female) index190_female,
max(index191_female) index191_female,
max(index192_female) index192_female,
max(index193_female) index193_female,
max(index194_female) index194_female,
max(index195_female) index195_female,
max(index196_female) index196_female,
max(index197_female) index197_female,
max(index198_female) index198_female,
max(index199_female) index199_female,
max(index200_female) index200_female,
max(index201_female) index201_female,
max(index202_female) index202_female,
max(index203_female) index203_female,
max(index204_female) index204_female,
max(index205_female) index205_female,
max(index206_female) index206_female,
max(index207_female) index207_female,
max(index208_female) index208_female,
max(index209_female) index209_female,
max(index210_female) index210_female,
max(index211_female) index211_female,
max(index212_female) index212_female,
max(index213_female) index213_female,
max(index214_female) index214_female
from 
(
  select xx.device, 
  case when index= 74 and tag=0 then cos_sim else -99 end index1,
  case when index= 75 and tag=0 then cos_sim else -99 end index2,
  case when index= 76 and tag=0 then cos_sim else -99 end index3,
  case when index= 77 and tag=0 then cos_sim else -99 end index4,
  case when index= 78 and tag=0 then cos_sim else -99 end index5,
  case when index= 79 and tag=0 then cos_sim else -99 end index6,
  case when index= 80 and tag=0 then cos_sim else -99 end index7,
  case when index= 81 and tag=0 then cos_sim else -99 end index8,
  case when index= 82 and tag=0 then cos_sim else -99 end index9,
  case when index= 83 and tag=0 then cos_sim else -99 end index10,
  case when index= 84 and tag=0 then cos_sim else -99 end index11,
  case when index= 85 and tag=0 then cos_sim else -99 end index12,
  case when index= 86 and tag=0 then cos_sim else -99 end index13,
  case when index= 87 and tag=0 then cos_sim else -99 end index14,
  case when index= 88 and tag=0 then cos_sim else -99 end index15,
  case when index= 89 and tag=0 then cos_sim else -99 end index16,
  case when index= 90 and tag=0 then cos_sim else -99 end index17,
  case when index= 91 and tag=0 then cos_sim else -99 end index18,
  case when index= 92 and tag=0 then cos_sim else -99 end index19,
  case when index= 93 and tag=0 then cos_sim else -99 end index20,
  case when index= 94 and tag=0 then cos_sim else -99 end index21,
  case when index= 95 and tag=0 then cos_sim else -99 end index22,
  case when index= 96 and tag=0 then cos_sim else -99 end index23,
  case when index= 97 and tag=0 then cos_sim else -99 end index24,
  case when index= 98 and tag=0 then cos_sim else -99 end index25,
  case when index= 99 and tag=0 then cos_sim else -99 end index26,
  case when index= 100 and tag=0 then cos_sim else -99 end index27,
  case when index= 101 and tag=0 then cos_sim else -99 end index28,
  case when index= 102 and tag=0 then cos_sim else -99 end index29,
  case when index= 103 and tag=0 then cos_sim else -99 end index30,
  case when index= 104 and tag=0 then cos_sim else -99 end index31,
  case when index= 105 and tag=0 then cos_sim else -99 end index32,
  case when index= 106 and tag=0 then cos_sim else -99 end index33,
  case when index= 107 and tag=0 then cos_sim else -99 end index34,
  case when index= 108 and tag=0 then cos_sim else -99 end index35,
  case when index= 109 and tag=0 then cos_sim else -99 end index36,
  case when index= 110 and tag=0 then cos_sim else -99 end index37,
  case when index= 111 and tag=0 then cos_sim else -99 end index38,
  case when index= 112 and tag=0 then cos_sim else -99 end index39,
  case when index= 113 and tag=0 then cos_sim else -99 end index40,
  case when index= 114 and tag=0 then cos_sim else -99 end index41,
  case when index= 115 and tag=0 then cos_sim else -99 end index42,
  case when index= 116 and tag=0 then cos_sim else -99 end index43,
  case when index= 117 and tag=0 then cos_sim else -99 end index44,
  case when index= 118 and tag=0 then cos_sim else -99 end index45,
  case when index= 119 and tag=0 then cos_sim else -99 end index46,
  case when index= 120 and tag=0 then cos_sim else -99 end index47,
  case when index= 121 and tag=0 then cos_sim else -99 end index48,
  case when index= 122 and tag=0 then cos_sim else -99 end index49,
  case when index= 123 and tag=0 then cos_sim else -99 end index50,
  case when index= 124 and tag=0 then cos_sim else -99 end index51,
  case when index= 125 and tag=0 then cos_sim else -99 end index52,
  case when index= 126 and tag=0 then cos_sim else -99 end index53,
  case when index= 127 and tag=0 then cos_sim else -99 end index54,
  case when index= 128 and tag=0 then cos_sim else -99 end index55,
  case when index= 129 and tag=0 then cos_sim else -99 end index56,
  case when index= 130 and tag=0 then cos_sim else -99 end index57,
  case when index= 131 and tag=0 then cos_sim else -99 end index58,
  case when index= 132 and tag=0 then cos_sim else -99 end index59,
  case when index= 133 and tag=0 then cos_sim else -99 end index60,
  case when index= 134 and tag=0 then cos_sim else -99 end index61,
  case when index= 135 and tag=0 then cos_sim else -99 end index62,
  case when index= 136 and tag=0 then cos_sim else -99 end index63,
  case when index= 137 and tag=0 then cos_sim else -99 end index64,
  case when index= 138 and tag=0 then cos_sim else -99 end index65,
  case when index= 139 and tag=0 then cos_sim else -99 end index66,
  case when index= 140 and tag=0 then cos_sim else -99 end index67,
  case when index= 141 and tag=0 then cos_sim else -99 end index68,
  case when index= 142 and tag=0 then cos_sim else -99 end index69,
  case when index= 143 and tag=0 then cos_sim else -99 end index70,
  case when index= 144 and tag=0 then cos_sim else -99 end index71,
  case when index= 145 and tag=0 then cos_sim else -99 end index72,
  case when index= 146 and tag=0 then cos_sim else -99 end index73,
  case when index= 147 and tag=0 then cos_sim else -99 end index74,
  case when index= 148 and tag=0 then cos_sim else -99 end index75,
  case when index= 149 and tag=0 then cos_sim else -99 end index76,
  case when index= 150 and tag=0 then cos_sim else -99 end index77,
  case when index= 151 and tag=0 then cos_sim else -99 end index78,
  case when index= 152 and tag=0 then cos_sim else -99 end index79,
  case when index= 153 and tag=0 then cos_sim else -99 end index80,
  case when index= 154 and tag=0 then cos_sim else -99 end index81,
  case when index= 155 and tag=0 then cos_sim else -99 end index82,
  case when index= 156 and tag=0 then cos_sim else -99 end index83,
  case when index= 157 and tag=0 then cos_sim else -99 end index84,
  case when index= 158 and tag=0 then cos_sim else -99 end index85,
  case when index= 159 and tag=0 then cos_sim else -99 end index86,
  case when index= 160 and tag=0 then cos_sim else -99 end index87,
  case when index= 161 and tag=0 then cos_sim else -99 end index88,
  case when index= 162 and tag=0 then cos_sim else -99 end index89,
  case when index= 163 and tag=0 then cos_sim else -99 end index90,
  case when index= 164 and tag=0 then cos_sim else -99 end index91,
  case when index= 165 and tag=0 then cos_sim else -99 end index92,
  case when index= 166 and tag=0 then cos_sim else -99 end index93,
  case when index= 167 and tag=0 then cos_sim else -99 end index94,
  case when index= 168 and tag=0 then cos_sim else -99 end index95,
  case when index= 169 and tag=0 then cos_sim else -99 end index96,
  case when index= 170 and tag=0 then cos_sim else -99 end index97,
  case when index= 171 and tag=0 then cos_sim else -99 end index98,
  case when index= 172 and tag=0 then cos_sim else -99 end index99,
  case when index= 173 and tag=0 then cos_sim else -99 end index100,
  case when index= 174 and tag=0 then cos_sim else -99 end index101,
  case when index= 175 and tag=0 then cos_sim else -99 end index102,
  case when index= 176 and tag=0 then cos_sim else -99 end index103,
  case when index= 177 and tag=0 then cos_sim else -99 end index104,
  case when index= 178 and tag=0 then cos_sim else -99 end index105,
  case when index= 179 and tag=0 then cos_sim else -99 end index106,
  case when index= 180 and tag=0 then cos_sim else -99 end index107,
  case when index= 181 and tag=0 then cos_sim else -99 end index108,
  case when index= 182 and tag=0 then cos_sim else -99 end index109,
  case when index= 183 and tag=0 then cos_sim else -99 end index110,
  case when index= 184 and tag=0 then cos_sim else -99 end index111,
  case when index= 185 and tag=0 then cos_sim else -99 end index112,
  case when index= 186 and tag=0 then cos_sim else -99 end index113,
  case when index= 187 and tag=0 then cos_sim else -99 end index114,
  case when index= 188 and tag=0 then cos_sim else -99 end index115,
  case when index= 189 and tag=0 then cos_sim else -99 end index116,
  case when index= 190 and tag=0 then cos_sim else -99 end index117,
  case when index= 191 and tag=0 then cos_sim else -99 end index118,
  case when index= 192 and tag=0 then cos_sim else -99 end index119,
  case when index= 193 and tag=0 then cos_sim else -99 end index120,
  case when index= 194 and tag=0 then cos_sim else -99 end index121,
  case when index= 195 and tag=0 then cos_sim else -99 end index122,
  case when index= 196 and tag=0 then cos_sim else -99 end index123,
  case when index= 197 and tag=0 then cos_sim else -99 end index124,
  case when index= 198 and tag=0 then cos_sim else -99 end index125,
  case when index= 199 and tag=0 then cos_sim else -99 end index126,
  case when index= 200 and tag=0 then cos_sim else -99 end index127,
  case when index= 201 and tag=0 then cos_sim else -99 end index128,
  case when index= 202 and tag=0 then cos_sim else -99 end index129,
  case when index= 203 and tag=0 then cos_sim else -99 end index130,
  case when index= 204 and tag=0 then cos_sim else -99 end index131,
  case when index= 205 and tag=0 then cos_sim else -99 end index132,
  case when index= 206 and tag=0 then cos_sim else -99 end index133,
  case when index= 207 and tag=0 then cos_sim else -99 end index134,
  case when index= 208 and tag=0 then cos_sim else -99 end index135,
  case when index= 209 and tag=0 then cos_sim else -99 end index136,
  case when index= 210 and tag=0 then cos_sim else -99 end index137,
  case when index= 211 and tag=0 then cos_sim else -99 end index138,
  case when index= 212 and tag=0 then cos_sim else -99 end index139,
  case when index= 213 and tag=0 then cos_sim else -99 end index140,
  case when index= 214 and tag=0 then cos_sim else -99 end index141,
  case when index= 215 and tag=0 then cos_sim else -99 end index142,
  case when index= 216 and tag=0 then cos_sim else -99 end index143,
  case when index= 217 and tag=0 then cos_sim else -99 end index144,
  case when index= 218 and tag=0 then cos_sim else -99 end index145,
  case when index= 219 and tag=0 then cos_sim else -99 end index146,
  case when index= 220 and tag=0 then cos_sim else -99 end index147,
  case when index= 221 and tag=0 then cos_sim else -99 end index148,
  case when index= 222 and tag=0 then cos_sim else -99 end index149,
  case when index= 223 and tag=0 then cos_sim else -99 end index150,
  case when index= 224 and tag=0 then cos_sim else -99 end index151,
  case when index= 225 and tag=0 then cos_sim else -99 end index152,
  case when index= 226 and tag=0 then cos_sim else -99 end index153,
  case when index= 227 and tag=0 then cos_sim else -99 end index154,
  case when index= 228 and tag=0 then cos_sim else -99 end index155,
  case when index= 229 and tag=0 then cos_sim else -99 end index156,
  case when index= 230 and tag=0 then cos_sim else -99 end index157,
  case when index= 231 and tag=0 then cos_sim else -99 end index158,
  case when index= 232 and tag=0 then cos_sim else -99 end index159,
  case when index= 233 and tag=0 then cos_sim else -99 end index160,
  case when index= 234 and tag=0 then cos_sim else -99 end index161,
  case when index= 235 and tag=0 then cos_sim else -99 end index162,
  case when index= 236 and tag=0 then cos_sim else -99 end index163,
  case when index= 237 and tag=0 then cos_sim else -99 end index164,
  case when index= 238 and tag=0 then cos_sim else -99 end index165,
  case when index= 239 and tag=0 then cos_sim else -99 end index166,
  case when index= 240 and tag=0 then cos_sim else -99 end index167,
  case when index= 241 and tag=0 then cos_sim else -99 end index168,
  case when index= 242 and tag=0 then cos_sim else -99 end index169,
  case when index= 243 and tag=0 then cos_sim else -99 end index170,
  case when index= 244 and tag=0 then cos_sim else -99 end index171,
  case when index= 245 and tag=0 then cos_sim else -99 end index172,
  case when index= 246 and tag=0 then cos_sim else -99 end index173,
  case when index= 247 and tag=0 then cos_sim else -99 end index174,
  case when index= 248 and tag=0 then cos_sim else -99 end index175,
  case when index= 249 and tag=0 then cos_sim else -99 end index176,
  case when index= 250 and tag=0 then cos_sim else -99 end index177,
  case when index= 251 and tag=0 then cos_sim else -99 end index178,
  case when index= 252 and tag=0 then cos_sim else -99 end index179,
  case when index= 253 and tag=0 then cos_sim else -99 end index180,
  case when index= 254 and tag=0 then cos_sim else -99 end index181,
  case when index= 255 and tag=0 then cos_sim else -99 end index182,
  case when index= 256 and tag=0 then cos_sim else -99 end index183,
  case when index= 257 and tag=0 then cos_sim else -99 end index184,
  case when index= 258 and tag=0 then cos_sim else -99 end index185,
  case when index= 259 and tag=0 then cos_sim else -99 end index186,
  case when index= 260 and tag=0 then cos_sim else -99 end index187,
  case when index= 261 and tag=0 then cos_sim else -99 end index188,
  case when index= 262 and tag=0 then cos_sim else -99 end index189,
  case when index= 263 and tag=0 then cos_sim else -99 end index190,
  case when index= 264 and tag=0 then cos_sim else -99 end index191,
  case when index= 265 and tag=0 then cos_sim else -99 end index192,
  case when index= 266 and tag=0 then cos_sim else -99 end index193,
  case when index= 267 and tag=0 then cos_sim else -99 end index194,
  case when index= 268 and tag=0 then cos_sim else -99 end index195,
  case when index= 269 and tag=0 then cos_sim else -99 end index196,
  case when index= 270 and tag=0 then cos_sim else -99 end index197,
  case when index= 271 and tag=0 then cos_sim else -99 end index198,
  case when index= 272 and tag=0 then cos_sim else -99 end index199,
  case when index= 273 and tag=0 then cos_sim else -99 end index200,
  case when index= 274 and tag=0 then cos_sim else -99 end index201,
  case when index= 275 and tag=0 then cos_sim else -99 end index202,
  case when index= 276 and tag=0 then cos_sim else -99 end index203,
  case when index= 277 and tag=0 then cos_sim else -99 end index204,
  case when index= 278 and tag=0 then cos_sim else -99 end index205,
  case when index= 279 and tag=0 then cos_sim else -99 end index206,
  case when index= 280 and tag=0 then cos_sim else -99 end index207,
  case when index= 281 and tag=0 then cos_sim else -99 end index208,
  case when index= 282 and tag=0 then cos_sim else -99 end index209,
  case when index= 283 and tag=0 then cos_sim else -99 end index210,
  case when index= 284 and tag=0 then cos_sim else -99 end index211,
  case when index= 285 and tag=0 then cos_sim else -99 end index212,
  case when index= 286 and tag=0 then cos_sim else -99 end index213,
  case when index= 287 and tag=0 then cos_sim else -99 end index214,
  case when index= 74 and tag=1 then cos_sim else -99 end index1_female,
  case when index= 75 and tag=1 then cos_sim else -99 end index2_female,
  case when index= 76 and tag=1 then cos_sim else -99 end index3_female,
  case when index= 77 and tag=1 then cos_sim else -99 end index4_female,
  case when index= 78 and tag=1 then cos_sim else -99 end index5_female,
  case when index= 79 and tag=1 then cos_sim else -99 end index6_female,
  case when index= 80 and tag=1 then cos_sim else -99 end index7_female,
  case when index= 81 and tag=1 then cos_sim else -99 end index8_female,
  case when index= 82 and tag=1 then cos_sim else -99 end index9_female,
  case when index= 83 and tag=1 then cos_sim else -99 end index10_female,
  case when index= 84 and tag=1 then cos_sim else -99 end index11_female,
  case when index= 85 and tag=1 then cos_sim else -99 end index12_female,
  case when index= 86 and tag=1 then cos_sim else -99 end index13_female,
  case when index= 87 and tag=1 then cos_sim else -99 end index14_female,
  case when index= 88 and tag=1 then cos_sim else -99 end index15_female,
  case when index= 89 and tag=1 then cos_sim else -99 end index16_female,
  case when index= 90 and tag=1 then cos_sim else -99 end index17_female,
  case when index= 91 and tag=1 then cos_sim else -99 end index18_female,
  case when index= 92 and tag=1 then cos_sim else -99 end index19_female,
  case when index= 93 and tag=1 then cos_sim else -99 end index20_female,
  case when index= 94 and tag=1 then cos_sim else -99 end index21_female,
  case when index= 95 and tag=1 then cos_sim else -99 end index22_female,
  case when index= 96 and tag=1 then cos_sim else -99 end index23_female,
  case when index= 97 and tag=1 then cos_sim else -99 end index24_female,
  case when index= 98 and tag=1 then cos_sim else -99 end index25_female,
  case when index= 99 and tag=1 then cos_sim else -99 end index26_female,
  case when index= 100 and tag=1 then cos_sim else -99 end index27_female,
  case when index= 101 and tag=1 then cos_sim else -99 end index28_female,
  case when index= 102 and tag=1 then cos_sim else -99 end index29_female,
  case when index= 103 and tag=1 then cos_sim else -99 end index30_female,
  case when index= 104 and tag=1 then cos_sim else -99 end index31_female,
  case when index= 105 and tag=1 then cos_sim else -99 end index32_female,
  case when index= 106 and tag=1 then cos_sim else -99 end index33_female,
  case when index= 107 and tag=1 then cos_sim else -99 end index34_female,
  case when index= 108 and tag=1 then cos_sim else -99 end index35_female,
  case when index= 109 and tag=1 then cos_sim else -99 end index36_female,
  case when index= 110 and tag=1 then cos_sim else -99 end index37_female,
  case when index= 111 and tag=1 then cos_sim else -99 end index38_female,
  case when index= 112 and tag=1 then cos_sim else -99 end index39_female,
  case when index= 113 and tag=1 then cos_sim else -99 end index40_female,
  case when index= 114 and tag=1 then cos_sim else -99 end index41_female,
  case when index= 115 and tag=1 then cos_sim else -99 end index42_female,
  case when index= 116 and tag=1 then cos_sim else -99 end index43_female,
  case when index= 117 and tag=1 then cos_sim else -99 end index44_female,
  case when index= 118 and tag=1 then cos_sim else -99 end index45_female,
  case when index= 119 and tag=1 then cos_sim else -99 end index46_female,
  case when index= 120 and tag=1 then cos_sim else -99 end index47_female,
  case when index= 121 and tag=1 then cos_sim else -99 end index48_female,
  case when index= 122 and tag=1 then cos_sim else -99 end index49_female,
  case when index= 123 and tag=1 then cos_sim else -99 end index50_female,
  case when index= 124 and tag=1 then cos_sim else -99 end index51_female,
  case when index= 125 and tag=1 then cos_sim else -99 end index52_female,
  case when index= 126 and tag=1 then cos_sim else -99 end index53_female,
  case when index= 127 and tag=1 then cos_sim else -99 end index54_female,
  case when index= 128 and tag=1 then cos_sim else -99 end index55_female,
  case when index= 129 and tag=1 then cos_sim else -99 end index56_female,
  case when index= 130 and tag=1 then cos_sim else -99 end index57_female,
  case when index= 131 and tag=1 then cos_sim else -99 end index58_female,
  case when index= 132 and tag=1 then cos_sim else -99 end index59_female,
  case when index= 133 and tag=1 then cos_sim else -99 end index60_female,
  case when index= 134 and tag=1 then cos_sim else -99 end index61_female,
  case when index= 135 and tag=1 then cos_sim else -99 end index62_female,
  case when index= 136 and tag=1 then cos_sim else -99 end index63_female,
  case when index= 137 and tag=1 then cos_sim else -99 end index64_female,
  case when index= 138 and tag=1 then cos_sim else -99 end index65_female,
  case when index= 139 and tag=1 then cos_sim else -99 end index66_female,
  case when index= 140 and tag=1 then cos_sim else -99 end index67_female,
  case when index= 141 and tag=1 then cos_sim else -99 end index68_female,
  case when index= 142 and tag=1 then cos_sim else -99 end index69_female,
  case when index= 143 and tag=1 then cos_sim else -99 end index70_female,
  case when index= 144 and tag=1 then cos_sim else -99 end index71_female,
  case when index= 145 and tag=1 then cos_sim else -99 end index72_female,
  case when index= 146 and tag=1 then cos_sim else -99 end index73_female,
  case when index= 147 and tag=1 then cos_sim else -99 end index74_female,
  case when index= 148 and tag=1 then cos_sim else -99 end index75_female,
  case when index= 149 and tag=1 then cos_sim else -99 end index76_female,
  case when index= 150 and tag=1 then cos_sim else -99 end index77_female,
  case when index= 151 and tag=1 then cos_sim else -99 end index78_female,
  case when index= 152 and tag=1 then cos_sim else -99 end index79_female,
  case when index= 153 and tag=1 then cos_sim else -99 end index80_female,
  case when index= 154 and tag=1 then cos_sim else -99 end index81_female,
  case when index= 155 and tag=1 then cos_sim else -99 end index82_female,
  case when index= 156 and tag=1 then cos_sim else -99 end index83_female,
  case when index= 157 and tag=1 then cos_sim else -99 end index84_female,
  case when index= 158 and tag=1 then cos_sim else -99 end index85_female,
  case when index= 159 and tag=1 then cos_sim else -99 end index86_female,
  case when index= 160 and tag=1 then cos_sim else -99 end index87_female,
  case when index= 161 and tag=1 then cos_sim else -99 end index88_female,
  case when index= 162 and tag=1 then cos_sim else -99 end index89_female,
  case when index= 163 and tag=1 then cos_sim else -99 end index90_female,
  case when index= 164 and tag=1 then cos_sim else -99 end index91_female,
  case when index= 165 and tag=1 then cos_sim else -99 end index92_female,
  case when index= 166 and tag=1 then cos_sim else -99 end index93_female,
  case when index= 167 and tag=1 then cos_sim else -99 end index94_female,
  case when index= 168 and tag=1 then cos_sim else -99 end index95_female,
  case when index= 169 and tag=1 then cos_sim else -99 end index96_female,
  case when index= 170 and tag=1 then cos_sim else -99 end index97_female,
  case when index= 171 and tag=1 then cos_sim else -99 end index98_female,
  case when index= 172 and tag=1 then cos_sim else -99 end index99_female,
  case when index= 173 and tag=1 then cos_sim else -99 end index100_female,
  case when index= 174 and tag=1 then cos_sim else -99 end index101_female,
  case when index= 175 and tag=1 then cos_sim else -99 end index102_female,
  case when index= 176 and tag=1 then cos_sim else -99 end index103_female,
  case when index= 177 and tag=1 then cos_sim else -99 end index104_female,
  case when index= 178 and tag=1 then cos_sim else -99 end index105_female,
  case when index= 179 and tag=1 then cos_sim else -99 end index106_female,
  case when index= 180 and tag=1 then cos_sim else -99 end index107_female,
  case when index= 181 and tag=1 then cos_sim else -99 end index108_female,
  case when index= 182 and tag=1 then cos_sim else -99 end index109_female,
  case when index= 183 and tag=1 then cos_sim else -99 end index110_female,
  case when index= 184 and tag=1 then cos_sim else -99 end index111_female,
  case when index= 185 and tag=1 then cos_sim else -99 end index112_female,
  case when index= 186 and tag=1 then cos_sim else -99 end index113_female,
  case when index= 187 and tag=1 then cos_sim else -99 end index114_female,
  case when index= 188 and tag=1 then cos_sim else -99 end index115_female,
  case when index= 189 and tag=1 then cos_sim else -99 end index116_female,
  case when index= 190 and tag=1 then cos_sim else -99 end index117_female,
  case when index= 191 and tag=1 then cos_sim else -99 end index118_female,
  case when index= 192 and tag=1 then cos_sim else -99 end index119_female,
  case when index= 193 and tag=1 then cos_sim else -99 end index120_female,
  case when index= 194 and tag=1 then cos_sim else -99 end index121_female,
  case when index= 195 and tag=1 then cos_sim else -99 end index122_female,
  case when index= 196 and tag=1 then cos_sim else -99 end index123_female,
  case when index= 197 and tag=1 then cos_sim else -99 end index124_female,
  case when index= 198 and tag=1 then cos_sim else -99 end index125_female,
  case when index= 199 and tag=1 then cos_sim else -99 end index126_female,
  case when index= 200 and tag=1 then cos_sim else -99 end index127_female,
  case when index= 201 and tag=1 then cos_sim else -99 end index128_female,
  case when index= 202 and tag=1 then cos_sim else -99 end index129_female,
  case when index= 203 and tag=1 then cos_sim else -99 end index130_female,
  case when index= 204 and tag=1 then cos_sim else -99 end index131_female,
  case when index= 205 and tag=1 then cos_sim else -99 end index132_female,
  case when index= 206 and tag=1 then cos_sim else -99 end index133_female,
  case when index= 207 and tag=1 then cos_sim else -99 end index134_female,
  case when index= 208 and tag=1 then cos_sim else -99 end index135_female,
  case when index= 209 and tag=1 then cos_sim else -99 end index136_female,
  case when index= 210 and tag=1 then cos_sim else -99 end index137_female,
  case when index= 211 and tag=1 then cos_sim else -99 end index138_female,
  case when index= 212 and tag=1 then cos_sim else -99 end index139_female,
  case when index= 213 and tag=1 then cos_sim else -99 end index140_female,
  case when index= 214 and tag=1 then cos_sim else -99 end index141_female,
  case when index= 215 and tag=1 then cos_sim else -99 end index142_female,
  case when index= 216 and tag=1 then cos_sim else -99 end index143_female,
  case when index= 217 and tag=1 then cos_sim else -99 end index144_female,
  case when index= 218 and tag=1 then cos_sim else -99 end index145_female,
  case when index= 219 and tag=1 then cos_sim else -99 end index146_female,
  case when index= 220 and tag=1 then cos_sim else -99 end index147_female,
  case when index= 221 and tag=1 then cos_sim else -99 end index148_female,
  case when index= 222 and tag=1 then cos_sim else -99 end index149_female,
  case when index= 223 and tag=1 then cos_sim else -99 end index150_female,
  case when index= 224 and tag=1 then cos_sim else -99 end index151_female,
  case when index= 225 and tag=1 then cos_sim else -99 end index152_female,
  case when index= 226 and tag=1 then cos_sim else -99 end index153_female,
  case when index= 227 and tag=1 then cos_sim else -99 end index154_female,
  case when index= 228 and tag=1 then cos_sim else -99 end index155_female,
  case when index= 229 and tag=1 then cos_sim else -99 end index156_female,
  case when index= 230 and tag=1 then cos_sim else -99 end index157_female,
  case when index= 231 and tag=1 then cos_sim else -99 end index158_female,
  case when index= 232 and tag=1 then cos_sim else -99 end index159_female,
  case when index= 233 and tag=1 then cos_sim else -99 end index160_female,
  case when index= 234 and tag=1 then cos_sim else -99 end index161_female,
  case when index= 235 and tag=1 then cos_sim else -99 end index162_female,
  case when index= 236 and tag=1 then cos_sim else -99 end index163_female,
  case when index= 237 and tag=1 then cos_sim else -99 end index164_female,
  case when index= 238 and tag=1 then cos_sim else -99 end index165_female,
  case when index= 239 and tag=1 then cos_sim else -99 end index166_female,
  case when index= 240 and tag=1 then cos_sim else -99 end index167_female,
  case when index= 241 and tag=1 then cos_sim else -99 end index168_female,
  case when index= 242 and tag=1 then cos_sim else -99 end index169_female,
  case when index= 243 and tag=1 then cos_sim else -99 end index170_female,
  case when index= 244 and tag=1 then cos_sim else -99 end index171_female,
  case when index= 245 and tag=1 then cos_sim else -99 end index172_female,
  case when index= 246 and tag=1 then cos_sim else -99 end index173_female,
  case when index= 247 and tag=1 then cos_sim else -99 end index174_female,
  case when index= 248 and tag=1 then cos_sim else -99 end index175_female,
  case when index= 249 and tag=1 then cos_sim else -99 end index176_female,
  case when index= 250 and tag=1 then cos_sim else -99 end index177_female,
  case when index= 251 and tag=1 then cos_sim else -99 end index178_female,
  case when index= 252 and tag=1 then cos_sim else -99 end index179_female,
  case when index= 253 and tag=1 then cos_sim else -99 end index180_female,
  case when index= 254 and tag=1 then cos_sim else -99 end index181_female,
  case when index= 255 and tag=1 then cos_sim else -99 end index182_female,
  case when index= 256 and tag=1 then cos_sim else -99 end index183_female,
  case when index= 257 and tag=1 then cos_sim else -99 end index184_female,
  case when index= 258 and tag=1 then cos_sim else -99 end index185_female,
  case when index= 259 and tag=1 then cos_sim else -99 end index186_female,
  case when index= 260 and tag=1 then cos_sim else -99 end index187_female,
  case when index= 261 and tag=1 then cos_sim else -99 end index188_female,
  case when index= 262 and tag=1 then cos_sim else -99 end index189_female,
  case when index= 263 and tag=1 then cos_sim else -99 end index190_female,
  case when index= 264 and tag=1 then cos_sim else -99 end index191_female,
  case when index= 265 and tag=1 then cos_sim else -99 end index192_female,
  case when index= 266 and tag=1 then cos_sim else -99 end index193_female,
  case when index= 267 and tag=1 then cos_sim else -99 end index194_female,
  case when index= 268 and tag=1 then cos_sim else -99 end index195_female,
  case when index= 269 and tag=1 then cos_sim else -99 end index196_female,
  case when index= 270 and tag=1 then cos_sim else -99 end index197_female,
  case when index= 271 and tag=1 then cos_sim else -99 end index198_female,
  case when index= 272 and tag=1 then cos_sim else -99 end index199_female,
  case when index= 273 and tag=1 then cos_sim else -99 end index200_female,
  case when index= 274 and tag=1 then cos_sim else -99 end index201_female,
  case when index= 275 and tag=1 then cos_sim else -99 end index202_female,
  case when index= 276 and tag=1 then cos_sim else -99 end index203_female,
  case when index= 277 and tag=1 then cos_sim else -99 end index204_female,
  case when index= 278 and tag=1 then cos_sim else -99 end index205_female,
  case when index= 279 and tag=1 then cos_sim else -99 end index206_female,
  case when index= 280 and tag=1 then cos_sim else -99 end index207_female,
  case when index= 281 and tag=1 then cos_sim else -99 end index208_female,
  case when index= 282 and tag=1 then cos_sim else -99 end index209_female,
  case when index= 283 and tag=1 then cos_sim else -99 end index210_female,
  case when index= 284 and tag=1 then cos_sim else -99 end index211_female,
  case when index= 285 and tag=1 then cos_sim else -99 end index212_female,
  case when index= 286 and tag=1 then cos_sim else -99 end index213_female,
  case when index= 287 and tag=1 then cos_sim else -99 end index214_female
  from (
    select t1.device, t1.tag, t1.cate_l2, t1.cate_l2_id, 
    t1.distance, t2.device_m, t3.cate_l2_m, round(distance/device_m/cate_l2_m,4) cos_sim
    from (
      select t1.device, t2.cate_l2, t2.cate_l2_id, t2.tag, 
      sum(t1.d1*t2.d1+t1.d2*t2.d2+t1.d3*t2.d3+t1.d4*t2.d4+t1.d5*t2.d5+t1.d6*t2.d6+t1.d7*t2.d7+t1.d8*t2.d8+t1.d9*t2.d9+t1.d10*t2.d10+t1.d11*t2.d11+t1.d12*t2.d12+t1.d13*t2.d13+t1.d14*t2.d14+t1.d15*t2.d15+t1.d16*t2.d16+t1.d17*t2.d17+t1.d18*t2.d18+t1.d19*t2.d19+t1.d20*t2.d20+t1.d21*t2.d21+t1.d22*t2.d22+t1.d23*t2.d23+t1.d24*t2.d24+t1.d25*t2.d25+t1.d26*t2.d26+t1.d27*t2.d27+t1.d28*t2.d28+t1.d29*t2.d29+t1.d30*t2.d30+t1.d31*t2.d31+t1.d32*t2.d32+t1.d33*t2.d33+t1.d34*t2.d34+t1.d35*t2.d35+t1.d36*t2.d36+t1.d37*t2.d37+t1.d38*t2.d38+t1.d39*t2.d39+t1.d40*t2.d40+t1.d41*t2.d41+t1.d42*t2.d42+t1.d43*t2.d43+t1.d44*t2.d44+t1.d45*t2.d45+t1.d46*t2.d46+t1.d47*t2.d47+t1.d48*t2.d48+t1.d49*t2.d49+t1.d50*t2.d50+t1.d51*t2.d51+t1.d52*t2.d52+t1.d53*t2.d53+t1.d54*t2.d54+t1.d55*t2.d55+t1.d56*t2.d56+t1.d57*t2.d57+t1.d58*t2.d58+t1.d59*t2.d59+t1.d60*t2.d60+t1.d61*t2.d61+t1.d62*t2.d62+t1.d63*t2.d63+t1.d64*t2.d64+t1.d65*t2.d65+t1.d66*t2.d66+t1.d67*t2.d67+t1.d68*t2.d68+t1.d69*t2.d69+t1.d70*t2.d70+t1.d71*t2.d71+t1.d72*t2.d72+t1.d73*t2.d73+t1.d74*t2.d74+t1.d75*t2.d75+t1.d76*t2.d76+t1.d77*t2.d77+t1.d78*t2.d78+t1.d79*t2.d79+t1.d80*t2.d80+t1.d81*t2.d81+t1.d82*t2.d82+t1.d83*t2.d83+t1.d84*t2.d84+t1.d85*t2.d85+t1.d86*t2.d86+t1.d87*t2.d87+t1.d88*t2.d88+t1.d89*t2.d89+t1.d90*t2.d90+t1.d91*t2.d91+t1.d92*t2.d92+t1.d93*t2.d93+t1.d94*t2.d94+t1.d95*t2.d95+t1.d96*t2.d96+t1.d97*t2.d97+t1.d98*t2.d98+t1.d99*t2.d99+t1.d100*t2.d100) distance
      from $gender_device_cate_l2_app2vec_vec2_score t1
      join $dim_gender_app2vec_cate_l2_center t2
      on t1.cate_l2_id=t2.cate_l2_id and t1.day = '$day'
      group by t1.device, t2.cate_l2, t2.cate_l2_id, t2.tag
    ) t1 join 
    (
      select device, cate_l2_id, sqrt(sum(d1*d1+d2*d2+d3*d3+d4*d4+d5*d5+d6*d6+d7*d7+d8*d8+d9*d9+d10*d10+d11*d11+d12*d12+d13*d13+d14*d14+d15*d15+d16*d16+d17*d17+d18*d18+d19*d19+d20*d20+d21*d21+d22*d22+d23*d23+d24*d24+d25*d25+d26*d26+d27*d27+d28*d28+d29*d29+d30*d30+d31*d31+d32*d32+d33*d33+d34*d34+d35*d35+d36*d36+d37*d37+d38*d38+d39*d39+d40*d40+d41*d41+d42*d42+d43*d43+d44*d44+d45*d45+d46*d46+d47*d47+d48*d48+d49*d49+d50*d50+d51*d51+d52*d52+d53*d53+d54*d54+d55*d55+d56*d56+d57*d57+d58*d58+d59*d59+d60*d60+d61*d61+d62*d62+d63*d63+d64*d64+d65*d65+d66*d66+d67*d67+d68*d68+d69*d69+d70*d70+d71*d71+d72*d72+d73*d73+d74*d74+d75*d75+d76*d76+d77*d77+d78*d78+d79*d79+d80*d80+d81*d81+d82*d82+d83*d83+d84*d84+d85*d85+d86*d86+d87*d87+d88*d88+d89*d89+d90*d90+d91*d91+d92*d92+d93*d93+d94*d94+d95*d95+d96*d96+d97*d97+d98*d98+d99*d99+d100*d100)) device_m
      from $gender_device_cate_l2_app2vec_vec2_score
      and day = '$day'
      group by device, cate_l2_id
    ) t2 on t1.device=t2.device and t1.cate_l2_id=t2.cate_l2_id
    join $dim_gender_app2vec_cate_l2_center_vec_m t3 on t1.cate_l2_id=t3.cate_l2_id and t1.tag=t3.tag
  ) xx
  join ( select cate_l2_id, index from $dim_gender_app_cate_index2 ) yy on xx.cate_l2_id = yy.cate_l2_id
) z
group by device;
"

#hive -e "alter table $gender_feature_v2_part17 drop partition(day<$p7);"
hive -e "alter table $gender_device_cate_l2_app2vec_vec2_score drop partition(day<$p7);"